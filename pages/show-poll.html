<link rel="import" href="../components/polymer/polymer.html">

<link href="../features/poll-service.html" rel="import">
<link href="../components/core-icons/core-icons.html" rel="import">
<link href="../components/paper-checkbox/paper-checkbox.html" rel="import">

<polymer-element name="show-poll" attributes="pollId">
  <template>
    <style>
    :host {
      display: block;
      width: 100%;
    }
    .header {
      color: #bbb;
      font-size: 40px;
      margin-bottom: 20px;
      text-transform: uppercase;
    }
    paper-checkbox {
      padding: 20px 20px 20px 0;
    }
    p {
      padding: 5px;
    }
    </style>

    <poll-service id="pollService" on-get="{{setPoll}}"></poll-service>

    <div layout vertical center>
      <p class="header">{{poll.question.value}}</p>
      <template repeat="{{option in poll.options}}">
        <div horizontal layout justified style="width:300px">
          <paper-checkbox
            on-change="{{handleClick}}">
          </paper-checkbox>
          <h4 flex>{{option.value}}</h4>
          <p>{{option.count}}</p>
        </div>
      </template>

    </div>
  </template>

  <script>
  Polymer({
    ready: function() {

      // set small interval to check for poll id
      // app-router seems to be a little behind polymer ready event at times
      var checkForId = setInterval(function() {
        if(this.pollId) {
          this.getPoll(this.pollId);
          clearInterval(checkForId);
        }
      }.bind(this), 1);
    },
    getPoll: function(id) {
      this.$.pollService.get(id);
    },
    setPoll: function(event, data) {
      this.poll = data;
    },
    handleClick: function(event, detail, sender) {
      var checked = event.target.checked,
        option = sender.templateInstance.model.option;

      if(checked) {
        option.count++;
      } else {
        option.count--;
      }

      this.$.pollService.update(this.poll.id, this.poll);
    }
  });
  </script>
</polymer-element>
